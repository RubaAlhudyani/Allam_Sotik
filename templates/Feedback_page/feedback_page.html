<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>نطق الكلمة</title>
</head>
<body>
  <div>
    <h3>نطق الكلمة: الشمس</h3>
    <button onclick="startRecording()">ابدأ التسجيل</button>
    <button onclick="stopRecording()" id="stopButton" style="display:none;">إيقاف التسجيل</button>
    <button onclick="submitAudio()" id="submitButton" style="display:none;">إرسال</button>
  </div>

  <script>
    let mediaRecorder;
    let audioChunks = [];

    function startRecording() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];

          mediaRecorder.ondataavailable = event => audioChunks.push(event.data);

          mediaRecorder.onstop = () => {
            document.getElementById('submitButton').style.display = 'inline';
          };

          mediaRecorder.start();
          document.getElementById('stopButton').style.display = 'inline';
        });
    }

    function stopRecording() {
      mediaRecorder.stop();
      document.getElementById('stopButton').style.display = 'none';
    }

    function submitAudio() {
      const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
      const formData = new FormData();
      formData.append('audio', audioBlob, 'user_audio.wav');

      fetch('/process_audio', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => alert(data.feedback))
      .catch(error => console.error('Error:', error));
    }
  </script>
</body>
</html>
